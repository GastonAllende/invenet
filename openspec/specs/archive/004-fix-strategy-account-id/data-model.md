# Data Model: Fix Strategy Owner Field (accountId → userId)

**Date**: 2026-02-21  
**Feature**: [spec.md](./spec.md) | **Plan**: [plan.md](./plan.md) | **Research**: [research.md](./research.md)

## Overview

This is not a new data model — it is a targeted rename of one field across the existing `Strategy` entity and its database column. No fields are added, removed, or retyped. No relationships change.

---

## Entity: Strategy (Modified)

### Field Rename

| Layer                           | Old Name                           | New Name                     | Type            | Notes                                         |
| ------------------------------- | ---------------------------------- | ---------------------------- | --------------- | --------------------------------------------- |
| C# domain property              | `AccountId`                        | `UserId`                     | `Guid`          | Required, no FK constraint in code            |
| EF Core configuration reference | `s.AccountId`                      | `s.UserId`                   | —               | All lambda refs in `StrategyConfiguration.cs` |
| Database column                 | `AccountId` (maps to `account_id`) | `UserId` (maps to `user_id`) | `uuid NOT NULL` | Rename via EF migration                       |
| TypeScript interface            | `accountId`                        | `userId`                     | `string`        | ✅ Already done                               |

### No Other Changes

All other fields (`Id`, `Name`, `Description`, `IsDeleted`, `CreatedAt`, `UpdatedAt`) are unchanged. The `Trades` navigation property is unchanged. All response DTOs are unchanged (they never exposed the owner field).

---

## Database Migration: Rename Column and Indexes

### Column

```sql
ALTER TABLE strategies.strategies
  RENAME COLUMN "AccountId" TO "UserId";
```

### Indexes to drop and recreate

| Old index name                      | New index name                   | Columns                           |
| ----------------------------------- | -------------------------------- | --------------------------------- |
| `ix_strategies_account_id`          | `ix_strategies_user_id`          | `UserId`                          |
| `ix_strategies_account_active`      | `ix_strategies_user_active`      | `UserId, IsDeleted`               |
| `ix_strategies_account_name_unique` | `ix_strategies_user_name_unique` | `UserId, Name` (unique, filtered) |

### EF Core Migration (generated by `dotnet ef migrations add`)

```csharp
migrationBuilder.RenameColumn(
    name: "AccountId",
    table: "strategies",
    newName: "UserId",
    schema: "strategies");

migrationBuilder.RenameIndex(
    name: "ix_strategies_account_id",
    table: "strategies",
    newName: "ix_strategies_user_id",
    schema: "strategies");

migrationBuilder.RenameIndex(
    name: "ix_strategies_account_active",
    table: "strategies",
    newName: "ix_strategies_user_active",
    schema: "strategies");

migrationBuilder.RenameIndex(
    name: "ix_strategies_account_name_unique",
    table: "strategies",
    newName: "ix_strategies_user_name_unique",
    schema: "strategies");
```

> **Note**: `RenameColumn` and `RenameIndex` on PostgreSQL translate to `ALTER TABLE RENAME COLUMN` and `ALTER INDEX RENAME`, which are safe operations that preserve all data and do not require a table lock in PostgreSQL 10+.

---

## No Relationship Changes

- `Strategy → Trade` (one-to-many via `Trade.StrategyId`): unchanged
- User ownership: strategies continue to be owned by the authenticated user via their identity ID — the only change is that the field correctly declares this via its name
