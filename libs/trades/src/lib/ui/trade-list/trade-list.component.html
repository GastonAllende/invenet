<div class="trade-list-container">
  <div class="list-header">
    <h3>Journal</h3>
    <div class="list-controls">
      <p-button label="Log Trade (full)" icon="pi pi-plus" (onClick)="onLogFull()"></p-button>
      <p-button
        label="Quick Log Trade"
        icon="pi pi-bolt"
        severity="secondary"
        [outlined]="true"
        (onClick)="onQuickLog()"
      ></p-button>
    </div>
  </div>

  <div class="filters">
    <p-select
      [options]="accounts()"
      [ngModel]="selectedAccountId()"
      optionLabel="name"
      optionValue="id"
      placeholder="Account"
      disabled
    ></p-select>
    <p-select
      [options]="strategies()"
      [(ngModel)]="selectedStrategyId"
      optionLabel="name"
      optionValue="id"
      [showClear]="true"
      placeholder="Strategy"
      (ngModelChange)="onFilterChange()"
    ></p-select>
    <p-datepicker
      [(ngModel)]="selectedRange"
      selectionMode="range"
      [showIcon]="true"
      placeholder="Date range"
      (onSelect)="onFilterChange()"
    ></p-datepicker>
    <p-select
      [options]="statusOptions"
      [(ngModel)]="selectedStatus"
      optionLabel="label"
      optionValue="value"
      placeholder="Status"
      (ngModelChange)="onFilterChange()"
    ></p-select>
    <div class="archived-toggle">
      <p-checkbox
        [binary]="true"
        [ngModel]="includeArchived()"
        (ngModelChange)="onToggleArchived($event)"
        inputId="showArchived"
      ></p-checkbox>
      <label for="showArchived">Show archived</label>
    </div>
  </div>

  <p-table
    [value]="trades()"
    [loading]="isLoading()"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} trades"
    [tableStyle]="{ 'min-width': '90rem' }"
    styleClass="p-datatable-striped"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Date</th>
        <th>Symbol</th>
        <th>Direction</th>
        <th>Account</th>
        <th>Strategy</th>
        <th>R-Multiple</th>
        <th>P&amp;L</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-trade>
      <tr>
        <td>{{ trade.openedAt | date: 'short' }}</td>
        <td><strong>{{ trade.symbol }}</strong></td>
        <td>
          <p-tag [value]="trade.direction" [severity]="getDirectionSeverity(trade.direction)"></p-tag>
        </td>
        <td>{{ getAccountName(trade.accountId) }}</td>
        <td>
          {{ trade.strategyName ?? '—' }}
          @if (trade.strategyVersionNumber) {
            <span class="strategy-version">v{{ trade.strategyVersionNumber }}</span>
          }
        </td>
        <td>{{ trade.rMultiple ?? '—' }}</td>
        <td [class.text-green-600]="(trade.pnl ?? 0) > 0" [class.text-red-600]="(trade.pnl ?? 0) < 0">
          {{ trade.pnl ?? '—' }}
        </td>
        <td>
          <p-tag [value]="trade.status" [severity]="getStatusSeverity(trade.status)"></p-tag>
          @if (trade.isArchived) {
            <p-tag value="ARCHIVED" severity="warn"></p-tag>
          }
        </td>
        <td>
          <div class="action-buttons">
            <p-button
              icon="pi pi-eye"
              [rounded]="true"
              [text]="true"
              severity="info"
              [disabled]="isLoading()"
              (onClick)="onView(trade.id)"
              pTooltip="View trade"
              tooltipPosition="top"
            ></p-button>
            @if (!trade.isArchived) {
              <p-button
                icon="pi pi-folder"
                [rounded]="true"
                [text]="true"
                severity="warn"
                [disabled]="isLoading()"
                (onClick)="onArchive(trade.id)"
                pTooltip="Archive trade"
                tooltipPosition="top"
              ></p-button>
            } @else {
              <p-button
                icon="pi pi-refresh"
                [rounded]="true"
                [text]="true"
                severity="success"
                [disabled]="isLoading()"
                (onClick)="onUnarchive(trade.id)"
                pTooltip="Unarchive trade"
                tooltipPosition="top"
              ></p-button>
            }
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
